# reminder-management Specification

## Purpose
TBD - created by archiving change add-room-availability-checker. Update Purpose after archive.
## Requirements
### Requirement: 定期執行提醒檢查
系統 SHALL 透過時間觸發器每 5 分鐘執行一次提醒檢查。

#### Scenario: 建立時間觸發器
- **WHEN** 首次部署或手動設定觸發器
- **THEN** 應建立一個每 5 分鐘執行的時間驅動觸發器
- **AND** 觸發器應呼叫主要的檢查函式

#### Scenario: 執行提醒檢查循環
- **WHEN** 時間觸發器啟動
- **THEN** 系統應讀取試算表中所有提醒
- **AND** 跳過狀態為"暫停"的提醒
- **AND** 逐一檢查每個啟用提醒的條件
- **AND** 對符合條件的提醒執行房間可用性查詢

### Requirement: 提醒時間範圍過濾
系統 SHALL 僅在提醒的指定時間範圍內執行檢查和發送通知。

#### Scenario: 當前時間在提醒範圍內
- **WHEN** 目前時間介於提醒開始時間和結束時間之間
- **THEN** 系統應執行該提醒的房間檢查
- **AND** 如發現空房應發送通知

#### Scenario: 當前時間在提醒範圍外
- **WHEN** 目前時間早於提醒開始時間或晚於提醒結束時間
- **THEN** 系統應跳過該提醒
- **AND** 不發送任何通知

#### Scenario: 跨日期的時間範圍
- **WHEN** 提醒結束時間早於開始時間 (例如: 23:00-01:00)
- **THEN** 系統應正確處理跨日情況
- **AND** 在正確的時間範圍內執行檢查

### Requirement: 提醒資料儲存
系統 SHALL 在試算表中儲存和管理提醒資料。

#### Scenario: 新增提醒
- **WHEN** 使用者透過網頁介面建立新提醒
- **THEN** 系統應在提醒清單工作表新增一列
- **AND** 包含所有提醒參數 (分店編號、房型代號、日期、時間等)

#### Scenario: 刪除提醒
- **WHEN** 使用者刪除特定提醒
- **THEN** 系統應從試算表移除對應的列
- **AND** 該提醒不再被定期檢查

### Requirement: 提醒資料欄位
系統 SHALL 在試算表的提醒清單工作表中儲存以下欄位。

#### Scenario: 提醒資料欄位定義
- **WHEN** 建立或讀取提醒
- **THEN** 應使用以下欄位結構:
  - 分店編號 (例如: "00066")
  - 分店名稱 (例如: "東京新宿店")
  - 房型代號 (10/20/30/40)
  - 房型名稱 (單人房/雙人房/雙床房/三人以上房)
  - 成人人數
  - 房間數
  - 入住日期 (YYYY-MM-DD)
  - 退房日期 (YYYY-MM-DD)
  - 提醒開始時間 (HH:MM)
  - 提醒結束時間 (HH:MM)
  - 建立時間 (時間戳記)

### Requirement: 提醒狀態追蹤
系統 SHALL 追蹤每個提醒的通知發送狀態,避免重複通知。

#### Scenario: 首次發現空房
- **WHEN** 首次檢查到某提醒有空房
- **THEN** 系統應發送通知
- **AND** 記錄該提醒已通知的狀態

#### Scenario: 持續有空房
- **WHEN** 某提醒在上次已通知後,再次檢查仍有空房
- **THEN** 系統應避免重複發送通知
- **AND** 可選擇性地記錄持續可用的時間

#### Scenario: 空房狀態變化
- **WHEN** 某提醒從無空房變為有空房
- **THEN** 系統應發送新的通知
- **AND** 更新通知狀態

### Requirement: 過期提醒處理
系統 SHALL 自動識別過期的提醒並停止檢查,但保留記錄。

#### Scenario: 識別過期提醒
- **WHEN** 提醒的退房日期早於今天
- **THEN** 該提醒應被標記為過期
- **AND** 不再執行房間檢查
- **AND** 保留在提醒清單中不自動刪除

#### Scenario: 顯示過期提醒
- **WHEN** 使用者檢視提醒清單
- **THEN** 過期的提醒應以不同樣式顯示 (例如: 灰色文字或特殊標記)
- **AND** 提供選項供使用者手動刪除

### Requirement: 提醒狀態管理
系統 SHALL 允許使用者暫停或啟用個別提醒。

#### Scenario: 暫停提醒
- **WHEN** 使用者將提醒狀態設為「暫停」
- **THEN** 該提醒在定期檢查時應被跳過
- **AND** 不執行房間檢查
- **AND** 不發送任何通知

#### Scenario: 啟用提醒
- **WHEN** 使用者將提醒狀態從「暫停」改為「啟用」
- **THEN** 該提醒在下次定期檢查時應被納入
- **AND** 恢復正常的檢查和通知流程

#### Scenario: 新建提醒預設狀態
- **WHEN** 使用者建立新提醒
- **THEN** 提醒狀態應預設為「啟用」
- **AND** 立即納入定期檢查循環

#### Scenario: 前端顯示提醒狀態
- **WHEN** 顯示提醒清單
- **THEN** 每個提醒應顯示目前狀態 (啟用/暫停)
- **AND** 提供切換按鈕或開關供使用者變更狀態

### Requirement: 檢查歷史記錄
系統 SHALL 記錄每次提醒檢查的詳細結果到檢查歷史工作表。

#### Scenario: 記錄成功檢查
- **WHEN** 完成一次房間可用性檢查
- **THEN** 系統應在檢查歷史工作表新增記錄
- **AND** 包含提醒 ID、檢查時間、結果和是否發送通知

#### Scenario: 記錄檢查錯誤
- **WHEN** 檢查過程中發生錯誤
- **THEN** 系統應記錄錯誤狀態和錯誤訊息
- **AND** 不中斷其他提醒的檢查

#### Scenario: 查詢檢查歷史
- **WHEN** 使用者需要檢視特定提醒的歷史
- **THEN** 系統應能根據提醒 ID 過濾記錄
- **AND** 按時間倒序顯示

