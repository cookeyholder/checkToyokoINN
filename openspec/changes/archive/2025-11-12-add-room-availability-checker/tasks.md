# 實作任務清單

## 1. 基礎設定與試算表整合

- [x] 1.1 建立試算表 ID 設定機制 (使用 PropertiesService 或程式碼常數)
- [x] 1.2 實作試算表存取函式 (`getSpreadsheet()`)
- [x] 1.3 實作分店資料讀取函式 (`getBranchList()`)
- [x] 1.4 實作房型代號讀取函式 (`getRoomTypeMapping()`)
- [x] 1.5 實作提醒清單讀取函式 (`getReminders()`) - 包含狀態過濾
- [x] 1.6 實作新增提醒函式 (`addReminder(reminderData)`) - 支援單一房型
- [x] 1.7 實作批次新增提醒函式 (`addBatchReminders(batchData)`) - 支援多房型,但不展開日期
- [x] 1.8 實作刪除提醒函式 (`deleteReminder(reminderId)`)
- [x] 1.9 實作更新提醒狀態函式 (`updateReminderStatus(reminderId, status)`)
- [x] 1.10 實作檢查歷史記錄函式 (`logCheckHistory(reminderId, result)`)
- [x] 1.11 實作讀取檢查歷史函式 (`getCheckHistory(reminderId)`)
- [x] 1.12 實作網站參數讀取函式 (`getParameter(paramName)`)
- [x] 1.13 實作帳號驗證函式 (`validateUser(email)`)
- [x] 1.14 測試所有試算表操作函式

## 2. 房間可用性檢查器

- [x] 2.1 實作查詢 URL 建構函式 (`buildQueryUrl(params)`)
- [x] 2.2 實作房間可用性檢查函式 (`checkRoomAvailability(params)`)
- [x] 2.3 實作 HTML 回應解析邏輯 (判斷是否有空房)
- [x] 2.4 加入錯誤處理 (網路錯誤、逾時、無效回應)
- [x] 2.5 加入 Logger 記錄以便追蹤
- [x] 2.6 測試各種情境 (有空房、無空房、錯誤情況)

## 3. 提醒管理系統

- [x] 3.1 實作時間範圍檢查函式 (`isWithinReminderTime(startTime, endTime)`)
- [x] 3.2 實作提醒檢查主函式 (`checkAllReminders()`) - 過濾暫停的提醒
- [x] 3.3 實作提醒狀態更新函式 (`updateReminderNotificationStatus(reminderId, status)`)
- [x] 3.4 實作過期提醒識別邏輯
- [x] 3.5 實作通知去重機制 (1 小時冷卻期)
- [x] 3.6 實作檢查歷史記錄邏輯 (每次檢查都記錄)
- [x] 3.7 建立時間觸發器設定函式 (`setupTimeTrigger()`)
- [x] 3.8 測試提醒檢查循環

## 4. Email 通知功能

- [x] 4.1 實作郵件內容生成函式 (`generateEmailContent(reminderData, roomUrl)`)
- [x] 4.2 實作 HTML 郵件範本
- [x] 4.3 實作訂房 URL 生成函式 (`generateBookingUrl(params)`)
- [x] 4.4 實作郵件發送函式 (`sendNotification(reminderData)`)
- [x] 4.5 加入郵件發送錯誤處理
- [x] 4.6 實作收件人 Email 取得邏輯 (`Session.getActiveUser().getEmail()`)
- [x] 4.7 測試郵件發送功能

## 5. 網頁應用程式介面

- [x] 5.1 建立 HTML 檔案 (`index.html`)
- [x] 5.2 實作登入驗證邏輯 (檢查使用者是否在帳號管理清單中)
- [x] 5.3 實作表單 HTML 結構 (所有輸入欄位)
- [x] 5.4 實作房型複選功能 (checkbox 或 multi-select)
- [x] 5.5 實作批次新增表單區塊
- [x] 5.6 實作提醒清單顯示區塊 (包含狀態顯示)
- [x] 5.7 實作檢查歷史顯示區塊 (模態框或側邊欄)
- [x] 5.8 加入 CSS 樣式 (響應式設計)
- [x] 5.9 實作前端 JavaScript (表單驗證、AJAX 呼叫)
- [x] 5.10 實作房型複選處理邏輯 (將多選轉換為多筆提醒)
- [x] 5.11 實作暫停/啟用切換功能 (前端)
- [x] 5.12 實作檢視歷史功能 (前端)
- [x] 5.13 實作 `doGet()` 函式 (回傳 HTML 頁面)
- [x] 5.14 實作表單提交處理函式 (後端) - 包含使用者驗證和房型拆分
- [x] 5.15 實作批次新增處理函式 (後端) - 支援多房型和多日期
- [x] 5.16 實作取得提醒清單 API 函式
- [x] 5.17 實作刪除提醒 API 函式
- [x] 5.18 實作切換提醒狀態 API 函式
- [x] 5.19 實作取得檢查歷史 API 函式
- [x] 5.20 實作取得分店選項 API 函式
- [x] 5.21 測試網頁應用程式部署

## 6. 資料驗證與錯誤處理

- [x] 6.1 實作表單資料驗證函式 (`validateReminderData(data)`)
- [x] 6.2 加入日期邏輯驗證 (退房日期至少比入住日期晚 1 天)
- [x] 6.3 加入日期選擇器最小日期限制 (不允許選取過去日期)
- [x] 6.4 實作入住日期變更時自動更新退房日期最小值
- [x] 6.5 加入時間格式驗證 (HH:MM)
- [x] 6.6 加入數值範圍驗證 (成人人數、房間數)
- [x] 6.7 實作使用者友善的錯誤訊息
- [x] 6.8 測試各種無效輸入情境

## 7. 權限與部署設定

- [x] 7.1 更新 `appsscript.json` 加入必要的 OAuth 範圍
- [x] 7.2 設定網頁應用程式部署 (執行身分、存取權限)
- [x] 7.3 測試授權流程
- [x] 7.4 建立部署說明文件

## 8. 測試與除錯

- [x] 8.1 端對端測試: 建立提醒 → 觸發檢查 → 收到通知
- [x] 8.2 測試帳號驗證功能 (啟用/停用使用者)
- [x] 8.3 測試時間範圍過濾邏輯
- [x] 8.4 測試暫停/啟用功能
- [x] 8.5 測試房型複選功能 (2-4 個房型)
- [x] 8.6 測試批次新增功能 (連續多晚 + 多房型,例如: 3晚2房型=2筆提醒)
- [x] 8.7 驗證每筆提醒記錄僅包含單一 roomType
- [x] 8.8 測試檢查歷史記錄和查詢
- [x] 8.9 測試網站參數設定讀取
- [x] 8.10 測試多個提醒同時執行的情況
- [x] 8.11 測試錯誤恢復機制
- [x] 8.12 檢查 Logger 輸出是否完整
- [x] 8.13 驗證郵件內容格式和連結正確性
- [x] 8.14 測試刪除提醒功能
- [x] 8.15 驗證 1 小時冷卻時間機制
- [x] 8.16 效能測試 (大量提醒的執行時間)

## 9. 文件與優化

- [x] 9.1 加入程式碼註解說明關鍵邏輯
- [x] 9.2 建立使用者操作指南 (README) - 包含批次新增和狀態管理說明
- [x] 9.3 建立試算表範本說明 (包含所有 6 個工作表的結構)
- [x] 9.4 文件化帳號管理流程
- [x] 9.5 文件化網站參數設定說明
- [x] 9.6 說明過期提醒的處理方式 (保留但不檢查)
- [x] 9.7 說明歷史記錄永久保存策略
- [x] 9.8 優化程式碼結構和可讀性
- [x] 9.9 檢查 GAS 配額使用情況並優化
