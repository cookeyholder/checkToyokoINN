# 新增東橫 INN 房間可用性檢查系統

## Why

目前專案沒有任何功能實作。需要建立一個完整的網頁應用程式,讓使用者能夠:
1. 設定要監控的東橫 INN 分店、房型和入住日期
2. 自動定期檢查是否有禁菸空房
3. 在指定時間範圍內發現空房時收到 Email 通知

這個系統解決了手動重複檢查飯店訂房網站的痛點,提高預訂熱門飯店房間的成功率。

## What Changes

- **新增網頁應用程式介面**: 使用 HTML Service 建立前端表單和提醒清單顯示
- **新增房間可用性檢查器**: 透過 UrlFetchApp 查詢東橫 INN API,解析回應判斷是否有空房
- **新增提醒管理系統**: 建立、儲存、刪除和執行提醒任務,支援暫停/啟用功能
- **新增批次新增功能**: 允許使用者一次為多個日期建立提醒
- **新增試算表資料管理**: 讀取分店資料、房型代號,管理提醒清單和檢查歷史
- **新增檢查歷史記錄**: 記錄每次檢查的時間、結果和通知狀態
- **新增 Email 通知功能**: 發現空房時自動寄送通知郵件給使用者 (1 小時冷卻期)
- **新增時間觸發器設定**: 每 5 分鐘執行一次檢查,僅在提醒時間範圍內發送通知

## Impact

### 受影響的能力
- **web-ui** (新增): 網頁應用程式介面
- **room-checker** (新增): 房間可用性檢查邏輯
- **reminder-management** (新增): 提醒任務管理
- **spreadsheet-data** (新增): 試算表資料存取
- **email-notification** (新增): Email 通知發送

### 受影響的程式碼
- `程式碼.js`: 將實作所有核心邏輯
- 新增 HTML 檔案: 前端介面 (例如: `index.html`)
- `appsscript.json`: 需要新增必要的權限設定

### 外部相依
- **東橫 INN API**: `https://www.toyoko-inn.com/china/search/result/room_plan/`
- **Google Sheets**: 預先建立的試算表,包含六個工作表:
  - 東橫INN分店 (標題列: 分店名稱、分店編號)
  - 提醒清單 (包含提醒狀態欄位)
  - 房型代號對照表
  - 檢查歷史 (記錄每次檢查結果)
  - 網站參數設定 (系統設定參數)
  - 帳號管理 (使用者帳號資訊)
- **Google Apps Script Services**:
  - HtmlService (網頁應用程式)
  - UrlFetchApp (HTTP 請求)
  - SpreadsheetApp (試算表操作)
  - GmailApp 或 MailApp (郵件發送)
  - ScriptApp (觸發器管理)
  - Session (取得使用者 Email)

## Technical Considerations

### 配額限制
- **UrlFetch 呼叫**: 每天 20,000 次 (每 5 分鐘檢查,每天最多 288 次)
- **Email 配額**: 免費帳戶每天 100 封,G Suite 每天 1,500 封
- **執行時間**: 單次執行最多 6 分鐘

### 錯誤處理
- 網路請求失敗需要適當的錯誤處理和重試機制
- 試算表讀取失敗需要清楚的錯誤訊息
- 郵件發送失敗需要記錄但不中斷程式

### 資料格式
- 日期格式: `YYYY-MM-DD` (ISO 8601)
- 時間格式: `HH:MM` (24 小時制)
- 試算表欄位需要明確定義和文件化
