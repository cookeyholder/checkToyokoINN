# 東橫 INN 空房監控系統 - 架構文件

## 程式碼架構

```
├─ 第 1 階段: 試算表整合 (1.1-1.14)
│  └─ CRUD 操作、使用者驗證
├─ 第 2 階段: 房間檢查器 (2.1-2.6)
│  └─ API 查詢、HTML 解析
├─ 第 3 階段: 提醒管理系統 (3.1-3.8)
│  └─ 時間篩選、冷卻機制、主循環
├─ 第 4 階段: 郵件通知 (4.1-4.7)
│  └─ HTML 生成、GmailApp 整合
├─ 第 5 階段: 網頁應用程式介面 (5.1-5.8)
│  └─ doGet(), API 處理器
├─ 第 6 階段: 資料驗證 (6.1-6.8)
│  └─ 輸入驗證、錯誤訊息
├─ 第 7 階段: 權限與部署 (7.1-7.4)
│  └─ OAuth 驗證、初始化
├─ 第 8 階段: 測試 (8.1-8.16)
│  └─ 單元測試、整合測試
└─ 第 9 階段: 文件和最佳化 (9.1-9.9)
   └─ 文件、指南、最佳化
```

## 檔案結構

- `程式碼.js` - 主要業務邏輯
- `scrapers.gs` - 東橫 INN 官網爬蟲
- `index.html` - 前端網頁介面
- `appsscript.json` - Apps Script 設定檔

## 效能最佳化策略

1. 批量讀取提醒而非逐筆查詢
2. 使用適當的欄位篩選
3. 快取常用的工作表物件
4. 及時刪除大型物件參考
5. 監控執行時間配額 (Google Apps Script: 6 分鐘)

## Google Apps Script 配額

- **執行時間**: 每次執行最多 6 分鐘
- **郵件服務**: 每天最多 100 封 (免費) 或 1500 封 (Google Workspace)
- **URL 擷取**: 每天約 20,000 次呼叫
- **試算表讀寫**: 無硬限制但受 getValues() 操作次數影響

## 資料表結構

### 提醒工作表
- 分店編號、分店名稱
- 房型代號、房型名稱
- 成人人數、房間數
- 入住日期、退房日期
- 提醒開始時間、提醒結束時間
- 使用者 Email
- 建立時間、最後通知時間
- 通知狀態、提醒狀態

### 檢查歷史工作表
- 提醒 ID
- 檢查時間
- 檢查結果
- 錯誤訊息
- 是否發送通知

### 東橫INN分店工作表
- 分店名稱
- 分店編號
- 地區
- 都道府縣

### 房型代號工作表
- 房型代號
- 房型名稱

### 網站參數設定工作表
- 參數項目
- 參數內容
- 參數說明

### 帳號管理工作表
- Email
- 姓名
- 人員編號
- 部門單位
- 群組
- 狀態
- 備註
